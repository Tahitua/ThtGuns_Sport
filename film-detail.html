<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Film - CineStream</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .movie-detail {
            background: linear-gradient(135deg, rgba(44, 44, 88, 0.9), rgba(108, 46, 183, 0.9)), 
                        url('') center/cover;
            min-height: 600px;
            display: flex;
            align-items: center;
            padding: 40px;
            position: relative;
        }
        
        .movie-detail-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 40px;
            width: 100%;
        }
        
        .movie-poster-large {
            width: 100%;
            height: 450px;
            border-radius: 12px;
            overflow: hidden;
            background: linear-gradient(135deg, #2b2b4b, #6c2eb7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #bdbdf7;
        }
        
        .movie-poster-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .movie-details {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .movie-title {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .movie-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .meta-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .movie-description {
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 30px;
            color: #e0e0ff;
        }
        
        .movie-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .movie-info-section {
            margin-top: 40px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            padding: 40px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .info-card {
            background: #23234a;
            padding: 25px;
            border-radius: 12px;
        }
        
        .info-card h3 {
            color: #b48cff;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .cast-list, .crew-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .cast-member, .crew-member {
            background: #2b2b4b;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .recommendations {
            margin-top: 50px;
        }
        
        .recommendations h2 {
            color: #b48cff;
            margin-bottom: 25px;
            font-size: 1.8rem;
        }
        
        @media (max-width: 768px) {
            .movie-detail-content {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 30px;
            }
            
            .movie-poster-large {
                max-width: 300px;
                margin: 0 auto;
                height: 400px;
            }
            
            .movie-title {
                font-size: 2.2rem;
            }
            
            .movie-detail {
                padding: 20px;
            }
            
            .movie-info-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">CineStream</div>
        <nav>
            <ul>
                <li><a href="index.html">Accueil</a></li>
                <li><a href="catalogue.html">Films</a></li>
                <li><a href="catalogue.html?type=series">Séries</a></li>
                <li><a href="ma-liste.html">Ma Liste</a></li>
                <li><a href="#" id="search-btn">Recherche</a></li>
            </ul>
        </nav>
        <div class="search-container" id="search-container" style="display: none;">
            <input type="text" id="search-input" placeholder="Rechercher un film...">
            <button id="search-close">&times;</button>
        </div>
    </header>

    <main>
        <div class="movie-detail" id="movie-detail">
            <div class="movie-detail-content">
                <div class="movie-poster-large" id="movie-poster">
                    <span>Chargement...</span>
                </div>
                
                <div class="movie-details">
                    <h1 class="movie-title" id="movie-title">Chargement...</h1>
                    
                    <div class="movie-meta" id="movie-meta">
                        <!-- Meta information will be loaded here -->
                    </div>
                    
                    <p class="movie-description" id="movie-description">
                        Chargement de la description...
                    </p>
                    
                    <div class="movie-actions">
                        <button class="btn btn-primary" id="watch-movie">
                            <i class="icon-play"></i> Regarder maintenant
                        </button>
                        <button class="btn btn-secondary" id="watch-trailer">
                            <i class="icon-play"></i> Bande-annonce
                        </button>
                        <button class="btn btn-list" id="toggle-list">
                            <i class="icon-plus"></i> Ajouter à ma liste
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="movie-info-section">
            <div class="info-grid">
                <div class="info-card">
                    <h3>Distribution</h3>
                    <div class="cast-list" id="cast-list">
                        <!-- Cast will be loaded here -->
                    </div>
                </div>
                
                <div class="info-card">
                    <h3>Équipe technique</h3>
                    <div class="crew-list" id="crew-list">
                        <!-- Crew will be loaded here -->
                    </div>
                </div>
                
                <div class="info-card">
                    <h3>Détails</h3>
                    <div id="movie-details-info">
                        <!-- Details will be loaded here -->
                    </div>
                </div>
                
                <div class="info-card">
                    <h3>Mots-clés</h3>
                    <div class="cast-list" id="keywords-list">
                        <!-- Keywords will be loaded here -->
                    </div>
                </div>
            </div>

            <div class="recommendations">
                <h2>Films similaires</h2>
                <div class="movie-carousel" id="recommendations-carousel">
                    <!-- Recommendations will be loaded here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Fullscreen player -->
    <div id="fullscreen-player" style="display:none; position:fixed; z-index:9999; top:0; left:0; width:100vw; height:100vh; background:#181828; align-items:center; justify-content:center; flex-direction:column;">
        <button id="close-player" style="margin-bottom:18px; padding:10px 24px; border:none; border-radius:8px; background:#6c2eb7; color:#fff; font-size:1.2rem; cursor:pointer;">Fermer</button>
        <div id="fullscreen-iframe-container" style="width:90vw; max-width:900px; height:70vh; display:flex; align-items:center; justify-content:center;">
            <!-- L'iframe vidéo sera injecté ici -->
        </div>
    </div>

    <footer>
        <p>&copy; 2025 CineStream - Votre plateforme de streaming favorite</p>
        <div class="footer-links">
            <a href="#about">À propos</a>
            <a href="#contact">Contact</a>
            <a href="#privacy">Confidentialité</a>
            <a href="#terms">Conditions</a>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script>
        let currentMovie = null;

        document.addEventListener('DOMContentLoaded', function() {
            // Wait for main.js to load films data
            const checkForData = setInterval(() => {
                if (window.CineStream && window.CineStream.filmsData) {
                    clearInterval(checkForData);
                    loadMovieDetail();
                }
            }, 100);

            // Initialize search functionality
            initSearchFunctionality();
        });

        function loadMovieDetail() {
            const urlParams = new URLSearchParams(window.location.search);
            const movieId = parseInt(urlParams.get('id'));
            
            const films = window.CineStream.filmsData.films;
            currentMovie = films.find(film => film.id === movieId);
            
            if (!currentMovie) {
                // Movie not found, redirect to catalog
                window.location.href = 'catalogue.html';
                return;
            }

            // Update page title
            document.title = `${currentMovie.titre} - CineStream`;
            
            // Load movie information
            displayMovieDetail();
            setupEventListeners();
            loadRecommendations();
        }

        function displayMovieDetail() {
            // Update background
            const movieDetail = document.getElementById('movie-detail');
            if (currentMovie.background) {
                movieDetail.style.backgroundImage = `linear-gradient(135deg, rgba(44, 44, 88, 0.9), rgba(108, 46, 183, 0.9)), url('${currentMovie.background}')`;
            }

            // Update poster
            const posterContainer = document.getElementById('movie-poster');
            if (currentMovie.affiche) {
                posterContainer.innerHTML = `<img src="${currentMovie.affiche}" alt="${currentMovie.titre}">`;
            } else {
                posterContainer.innerHTML = `<span>Image non disponible</span>`;
            }

            // Update title
            document.getElementById('movie-title').textContent = currentMovie.titre;

            // Update meta information
            const metaContainer = document.getElementById('movie-meta');
            metaContainer.innerHTML = `
                <span class="meta-item">${currentMovie.annee}</span>
                <span class="meta-item">${currentMovie.duree} min</span>
                <span class="meta-item">⭐ ${currentMovie.note}/10</span>
                <span class="meta-item">${currentMovie.genre.join(', ')}</span>
            `;

            // Update description
            document.getElementById('movie-description').textContent = currentMovie.description;

            // Update cast
            const castContainer = document.getElementById('cast-list');
            castContainer.innerHTML = currentMovie.acteurs.map(actor => 
                `<span class="cast-member">${actor}</span>`
            ).join('');

            // Update crew
            const crewContainer = document.getElementById('crew-list');
            crewContainer.innerHTML = `<span class="crew-member">Réalisateur: ${currentMovie.realisateur}</span>`;

            // Update details
            const detailsContainer = document.getElementById('movie-details-info');
            detailsContainer.innerHTML = `
                <p><strong>Durée:</strong> ${currentMovie.duree} minutes</p>
                <p><strong>Année:</strong> ${currentMovie.annee}</p>
                <p><strong>Note:</strong> ${currentMovie.note}/10</p>
                <p><strong>Réalisateur:</strong> ${currentMovie.realisateur}</p>
            `;

            // Update keywords
            const keywordsContainer = document.getElementById('keywords-list');
            keywordsContainer.innerHTML = currentMovie.motscles.map(keyword => 
                `<span class="cast-member">${keyword}</span>`
            ).join('');

            // Update list button
            updateListButton();
        }

        function setupEventListeners() {
            // Watch movie
            document.getElementById('watch-movie').addEventListener('click', () => {
                if (window.CineStream && window.CineStream.playMovie) {
                    window.CineStream.playMovie(currentMovie);
                }
            });

            // Watch trailer (same as movie for now)
            document.getElementById('watch-trailer').addEventListener('click', () => {
                if (window.CineStream && window.CineStream.playMovie) {
                    window.CineStream.playMovie(currentMovie);
                }
            });

            // Toggle my list
            document.getElementById('toggle-list').addEventListener('click', () => {
                if (window.CineStream && window.CineStream.toggleMyList) {
                    window.CineStream.toggleMyList(currentMovie.id);
                    updateListButton();
                }
            });

            // Close fullscreen player
            const closePlayer = document.getElementById('close-player');
            if (closePlayer) {
                closePlayer.addEventListener('click', closeFullscreenPlayer);
            }
        }

        function updateListButton() {
            const listButton = document.getElementById('toggle-list');
            const myList = JSON.parse(localStorage.getItem('myList')) || [];
            
            if (myList.includes(currentMovie.id)) {
                listButton.innerHTML = '<i class="icon-check"></i> Dans ma liste';
                listButton.classList.remove('btn-list');
                listButton.classList.add('btn-secondary');
            } else {
                listButton.innerHTML = '<i class="icon-plus"></i> Ajouter à ma liste';
                listButton.classList.remove('btn-secondary');
                listButton.classList.add('btn-list');
            }
        }

        function loadRecommendations() {
            const films = window.CineStream.filmsData.films;
            
            // Find movies with similar genres
            const similarMovies = films.filter(film => 
                film.id !== currentMovie.id && 
                film.genre.some(genre => currentMovie.genre.includes(genre))
            ).slice(0, 6);

            const recommendationsContainer = document.getElementById('recommendations-carousel');
            recommendationsContainer.innerHTML = '';

            similarMovies.forEach(movie => {
                const movieCard = createMovieCard(movie);
                recommendationsContainer.appendChild(movieCard);
            });
        }

        function createMovieCard(movie) {
            const card = document.createElement('div');
            card.className = 'movie-card';
            card.onclick = () => window.location.href = `film-detail.html?id=${movie.id}`;
            
            card.innerHTML = `
                <div class="movie-poster">
                    ${movie.affiche ? 
                        `<img src="${movie.affiche}" alt="${movie.titre}" onerror="this.style.display='none'">` : 
                        `<span>Image non disponible</span>`
                    }
                    <div class="play-overlay"></div>
                </div>
                <div class="movie-info">
                    <div class="movie-title">${movie.titre}</div>
                    <div class="movie-year">${movie.annee}</div>
                    <div class="movie-genre">${movie.genre.slice(0, 2).join(', ')}</div>
                    <div class="movie-rating">
                        ⭐ ${movie.note}/10
                    </div>
                </div>
            `;
            
            return card;
        }

        function initSearchFunctionality() {
            const searchBtn = document.getElementById('search-btn');
            const searchContainer = document.getElementById('search-container');
            const searchInput = document.getElementById('search-input');
            const searchClose = document.getElementById('search-close');
            
            if (searchBtn) {
                searchBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    searchContainer.style.display = searchContainer.style.display === 'none' ? 'block' : 'none';
                    if (searchContainer.style.display === 'block') {
                        searchInput.focus();
                    }
                });
            }
            
            if (searchClose) {
                searchClose.addEventListener('click', () => {
                    searchContainer.style.display = 'none';
                });
            }
            
            if (searchInput) {
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        window.location.href = `catalogue.html?search=${encodeURIComponent(e.target.value)}`;
                    }
                });
            }
        }

        function closeFullscreenPlayer() {
            const fullscreenPlayer = document.getElementById('fullscreen-player');
            const iframeContainer = document.getElementById('fullscreen-iframe-container');
            
            if (!fullscreenPlayer || !iframeContainer) return;
            
            fullscreenPlayer.style.display = 'none';
            iframeContainer.innerHTML = '';
            
            document.querySelector('header').style.display = '';
            document.querySelector('main').style.display = '';
            document.querySelector('footer').style.display = '';
        }
    </script>
</body>
</html>